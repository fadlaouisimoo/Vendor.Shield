<!DOCTYPE html>
<html lang="<%= lang || 'fr' %>" data-theme="<%= typeof theme !== 'undefined' ? theme : 'dark' %>">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= title || 'VendorShield' %></title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="/public/styles.css" />
	<script>
		// Initialize theme from localStorage
		(function() {
			const savedTheme = localStorage.getItem('theme') || 'dark';
			document.documentElement.setAttribute('data-theme', savedTheme);
			const sunIcon = document.getElementById('sunIcon');
			const moonIcon = document.getElementById('moonIcon');
			if (savedTheme === 'light' && sunIcon && moonIcon) {
				sunIcon.style.display = 'none';
				moonIcon.style.display = 'block';
			}
		})();
	</script>
</head>
<body>
	<header class="topbar">
		<div class="container">
			<a href="<%= urlWithLang('/admin') %>" class="brand" style="display:flex;align-items:center;gap:10px;text-decoration:none">
				<img src="/public/brand.svg" alt="Vendor Shield" style="height:30px;width:auto"/>
			</a>
			<nav style="display:flex;align-items:center;gap:12px">
				<a href="<%= urlWithLang('/admin') %>" style="display:inline-flex;align-items:center;gap:6px">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
					<%= t('common.dashboard') %>
				</a>
				<a class="btn accent" href="<%= urlWithLang('/suppliers/new') %>" style="display:inline-flex;align-items:center;gap:6px">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
					<%= t('common.newSupplier') %>
				</a>
				<% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
					<a class="btn" href="<%= urlWithLang('/logout') %>" style="display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#64748b,#475569);color:#fff">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
						<%= t('auth.logout') %>
					</a>
				<% } %>
				<div class="theme-controls">
					<button class="lang-toggle" id="langToggle" type="button" title="<%= lang === 'fr' ? 'Switch to English' : 'Passer en français' %>">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
						<span><%= lang === 'fr' ? 'EN' : 'FR' %></span>
					</button>
					<button class="theme-toggle" id="themeToggle" type="button" title="<%= lang === 'fr' ? 'Changer le thème' : 'Toggle theme' %>">
						<svg id="themeIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle id="sunIcon" cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
							<path id="moonIcon" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" style="display:none"/>
						</svg>
					</button>
				</div>
			</nav>
		</div>
	</header>
	<main class="container">
		<%- body %>
	</main>
	<footer class="footer">
		<div class="container">© <%= new Date().getFullYear() %> VendorShield</div>
	</footer>
    <div id="toast" class="toast" aria-live="polite" aria-atomic="true" hidden>Copié dans le presse‑papiers</div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        
        if (themeToggle) {
            themeToggle.addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                if (sunIcon && moonIcon) {
                    if (newTheme === 'light') {
                        sunIcon.style.display = 'none';
                        moonIcon.style.display = 'block';
                    } else {
                        sunIcon.style.display = 'block';
                        moonIcon.style.display = 'none';
                    }
                }
            });
        }
        
        // Language Toggle
        const langToggle = document.getElementById('langToggle');
        if (langToggle) {
            langToggle.addEventListener('click', function() {
                const currentLang = '<%= lang || "fr" %>';
                const newLang = currentLang === 'fr' ? 'en' : 'fr';
                // Set cookie first
                document.cookie = `lang=${newLang};path=/;max-age=${365 * 24 * 60 * 60}`;
                // Then redirect with lang parameter
                const url = new URL(window.location.href);
                url.searchParams.set('lang', newLang);
                window.location.href = url.toString();
            });
        }
        
        // Copy to clipboard
        document.addEventListener('click', async (e) => {
            const btn = e.target.closest('[data-copy]');
            if (!btn) return;
            const text = btn.getAttribute('data-copy');
            try {
                await navigator.clipboard.writeText(text);
                const toast = document.getElementById('toast');
                if (toast) {
                    toast.textContent = '<%= t("common.linkCopied") %>';
                    toast.hidden = false;
                    toast.classList.add('show');
                    setTimeout(() => { toast.classList.remove('show'); toast.hidden = true; }, 1400);
                }
            } catch (err) {
                alert('Impossible de copier: ' + err);
            }
        });
    });
    </script>
</body>
</html>


