<h2>Fournisseurs</h2>

<table class="table">
	<thead>
		<tr>
			<th>Nom</th>
			<th>Email</th>
			<th>Score</th>
			<th>Statut</th>
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>
		<% if (!suppliers || suppliers.length === 0) { %>
			<tr><td colspan="5" class="muted">Aucun fournisseur</td></tr>
		<% } %>
		<% (suppliers || []).forEach(s => { %>
			<tr>
				<td><a href="/suppliers/<%= s.id %>"><%= s.name %></a></td>
				<td><%= s.contact_email || '-' %></td>
				<td><strong><%= s.score %>%</strong></td>
				<td>
					<span class="badge <%= s.status === 'Conforme' ? 'ok' : (s.status === 'En cours' ? 'warn' : 'err') %>">
						<% if (s.status === 'Conforme') { %>
							<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#34d399" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;margin-right:6px"><polyline points="20 6 9 17 4 12"/></svg>
						<% } else if (s.status === 'En cours') { %>
							<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;margin-right:6px"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
						<% } else { %>
							<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;margin-right:6px"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
						<% } %>
						<%= s.status %>
					</span>
				</td>
				<td>
					<a class="btn" href="<%= baseUrl %>/invite/<%= s.invite_token %>" target="_blank">Lien d'invitation</a>
				</td>
			</tr>
		<% }) %>
	</tbody>
</table>

<section class="kpis">
	<div class="kpi">
		<div class="kpi-label">% conformes</div>
		<div class="kpi-value">
			<% const nb = (suppliers || []).length; const nbOk = (suppliers || []).filter(x => x.status === 'Conforme').length; const pct = nb ? Math.round((nbOk/nb)*100) : 0; %>
			<%= pct %>%
		</div>
	</div>
	<div class="kpi">
		<div class="kpi-label">Risques critiques identifi√©s</div>
		<div class="kpi-value">
			<% const nbCrit = (suppliers || []).filter(x => x.status === 'Non Conforme').length; %>
			<%= nbCrit %>
		</div>
	</div>
	<div class="kpi">
		<div class="kpi-label">Moyenne des scores</div>
		<div class="kpi-value">
			<% const avg = (suppliers || []).length ? Math.round((suppliers.reduce((a,b)=>a+(b.score||0),0)/(suppliers.length))) : 0; %>
			<%= avg %>%
		</div>
	</div>
</section>


